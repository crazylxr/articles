# 图片优化

## 前言

在大多数的 web 页面中，图片占到了页面大小的60%-70%。因此在web开发中，不同的场景使用合适的图片格式对web页面的性能和体验是很重要的。有时候你花大力气去配置 webpack 使打包体积减少，不如好好优化几张图片，这篇文章就是让你明白如何选择正确的图片，并且让你明白这么多图片格式，在什么场景下使用什么格式。

## 基本概念

在进入正题之前，先聊聊一些图片相关的基本概念。



一张照片（位图）不断放大之后，会看到一个个小格子，这些小格子，叫像素

![image-20190427232233742](/Users/licai/Library/Application Support/typora-user-images/image-20190427232233742.png)

一个格子（像素），在计算机中，用二进制来表示



一个格子（像素），使用的二进制位数越多，像素的色彩就越丰富

举例子，如果一个像素用一位二进制数表示，能有多少种颜色呢？

两种，一个二进制位，要不放0（表示黑色），要不放1（表示白色）



![image-20190427232245280](/Users/licai/Library/Application Support/typora-user-images/image-20190427232245280.png)

因为JPG图片使用24位二进制数来表示一个像素，所以能表示1600万种颜色



肉眼能分辨的颜色大概是1千万种，24位编码一像素能反映肉眼真实的色彩，叫真彩色

GIF的图片只保存了常用的256种颜色，并且按照索引0~255排序，叫索引色



### 颜色表

### 真彩色

### 根据压缩分类

- 无压缩。
- 无损压缩。
- 有损压缩。

#### 无压缩

无压缩的图片格式不对图片数据进行压缩处理，能准确地呈现原图片。BMP格式就是其中之一。

#### 有损压缩

指在压缩文件大小的过程中，损失了一部分图片的信息，也即降低了图片的质量，并且这种损失是不可逆的，我们不可能从有一个有损压缩过的图片中恢复出全来的图片。

常见的有损压缩手段，是按照一定的算法将临近的像素点进行合并。压缩算法不会对图片所有的数据进行编码压缩，而是在压缩的时候，去除了人眼无法识别的图片细节。因此有损压缩可以在同等图片质量的情况下大幅降低图片的尺寸。其中的代表是 jpg。

#### 无损压缩

只在压缩文件大小的过程中，图片的质量没有任何损耗。我们任何时候都可以从无损压缩过的图片中恢复出原来的信息。

压缩算法对图片的所有的数据进行编码压缩，能在保证图片的质量的同时降低图片的尺寸。

png 是其中的代表。

### 根据图的类型分类

- 点阵图(位图)
- 矢量图

#### 点阵图(位图)

点阵图，也叫做位图，像素图。构成点阵图的最小单位是像素，位图就是由像素阵列的排列来实现其显示效果的，每个象素有自己的颜色信息，在对位图图像进行编辑操作的时候，可操作的对象是每个像素，我们可以改变图像的色相、饱和度、明度，从而改变图像的显示效果。

点阵图缩放会失真，用最近非常流行的沙画来比喻最恰当不过，当你从远处看的时候，画面细腻多彩，但是当你靠的非常近的时候，你就能看到组成画面的每粒沙子以及每个沙粒的颜色。

常见的比如：jpg、png、webp等，我们平时遇到的大多数都是**位图**。

#### 矢量图

矢量图，也叫做向量图。矢量图并不纪录画面上每一点的信息，而是纪录了元素形状及颜色的算法，当你打开一付矢量图的时候，软件对图形象对应的函数进行运算，将运算结果[图形的形状和颜色]显示给你看。

无论显示画面是大还是小，画面上的对象对应的算法是不变的，所以，即使对画面进行倍数相当大的缩放，其显示效果仍然相同(不失真)。

常见的就是 svg 格式的。

### 透明与半透明

## gif

GIF 的特性是**帧动画**。

采用LZW压缩算法进行编码，是一种无损的基于索引色的图片格式

由于采用了无损压缩，相比古老的bmp格式，尺寸较小，而且支持透明和动画。缺点是由于gif只存储8位索引（也就是最多能表达2^8=256种颜色），色彩复杂、细节丰富的图片不适合保存为gif格式。色彩简单的logo、icon、线框图适合采用gif格式。

## JPG/JPEG

连续和基线概念

**照片大图用有损压缩的JPG**。

JPEG是有损的、采用直接色的、点阵图。

JPEG 图片格式的设计目标，是在不影响人类可分辨的图片质量的前提下，尽可能的压缩文件大小。这意味着 JPEG去掉了一部分图片的原始信息，也即是进行了有损压缩。JPEG 的图片的优点，是采用了直接色，得益于更丰富的色彩，JPEG 非常适合用来存储照片，用来表达更生动的图像效果，比如颜色渐变。

与 GIF 相比，JPEG 不适合用来存储企业 Logo、线框类的图。因为有损压缩会导致图片模糊，而直接色的选用，又会导致图片文件较GIF更大。

![image-20190427233640980](/Users/licai/Library/Application Support/typora-user-images/image-20190427233640980.png)

## png

PNG对于线条图，LOGO，图标和颜色较少的图像非常适合

PNG另一个优点是支持透明背景

### png8

PNG 全称 Portable Network Graphics，PNG-8 是 PNG 的索引色版本。PNG-8 是无损的、使用索引色的、点阵图。

PNG是一种比较新的图片格式，PNG-8是非常好的GIF格式替代者，在可能的情况下，应该尽可能的使用PNG-8而不是GIF，因为在相同的图片效果下，PNG-8具有更小的文件体积。除此之外，PNG-8还支持透明度的调节，而GIF并不支持。 现在，除非需要动画的支持，否则我们没有理由使用GIF而不是PNG-8。当然了，PNG-8本身也是支持动画的，只是浏览器支持得不好，不像GIF那样受到广泛的支持。

可以看到PNG-8具有更好的透明度支持。

### png24

PNG-24是PNG的直接色版本。PNG-24 是无损的、使用直接色的、点阵图。

无损的、使用直接色的点阵图，听起来非常像 BMP，是的，从显示效果上来看，PNG-24 跟 BMP 没有不同。PNG-24 的优点在于，它压缩了图片的数据，使得同样效果的图片，PNG-24 格式的文件大小要比 BMP 小得多。当然，PNG24 的图片还是要比 JPEG、GIF、PNG-8 大得多。

虽然 PNG-24 的一个很大的目标，是替换 JPEG 的使用。但一般而言，PNG-24 的文件大小是 JPEG 的五倍之多，而显示效果则通常只能获得一点点提升。所以，只有在你不在乎图片的文件体积，而想要最好的显示效果时，才应该使用 PNG-24 格式。

另外，PNG-24 跟 PNG-8 一样，是支持图片透明度的。



**png可以储存透明，完爆gif的地方在于失真小，没锯齿；劣势是不支持动画；**

png采用无损压缩，在多数情况下都可以保留图片里所有像素。PNG无损压缩算法，简单地说，就是把图片里出现的每一个颜色都记录下来。通过记录这些颜色相对应的值记录一张图片。



png分为两种，一种是Index，一种是RGB。Index记录同一种颜色的值和出现的位置（简单地说，比如一个2px*2px的超级小图，从左往右从上往下依次的颜色是红，白，白，红，那么记录的方法就是“红-1,4；白-2,3”）；而RGB图则把所有像素的色值依次记录下来（即“红，白，白红”）。对于相同的图片，Index格式的尺寸总是小于RGB。

## Base64



## webp

WebP 是谷歌开发的一种新图片格式，WebP 是同时支持有损和无损压缩的、使用直接色的、点阵图。

从名字就可以看出来它是为 Web 而生的，什么叫为 Web 而生呢？就是说相同质量的图片，WebP 具有更小的文件体积。现在网站上充满了大量的图片，如果能够降低每一个图片的文件大小，那么将大大减少浏览器和服务器之间的数据传输量，进而降低访问延迟，提升访问体验。

- 在无损压缩的情况下，相同质量的 WebP 图片，文件大小要比 PNG 小26%；
- 在有损压缩的情况下，具有相同图片精度的WebP图片，文件大小要比JPEG小25%~34%；
- WebP图片格式支持图片透明度，一个无损压缩的WebP图片，如果要支持透明度只需要22%的格外文件大小。

## svg

全称 Scalable Vector Graphics，是无损的、矢量图。

SVG 跟上面这些图片格式最大的不同，是 SVG 是矢量图。这意味着 SVG 图片由直线和曲线以及绘制它们的方法组成。当你放大一个 SVG 图片的时候，你看到的还是线和曲线，而不会出现像素点。这意味着 SVG 图片在放大时，不会失真，所以它非常适合用来绘制企业 Logo、Icon等。

SVG 是很多种矢量图中的一种，它的特点是使用 XML 来描述图片。借助于前几年 XML 技术的流行，SVG也流行了很多。使用XML的优点是，任何时候你都可以把它当做一个文本文件来对待，也就是说，你可以非常方便的修改SVG图片，你所需要的只需要一个文本编辑器。

SVG并非只能绘制简单的Logo类的图片，它可以绘制出精致的图片的。

## 为什么颜色越多，文件体积越大？

## 附加内容

1. **sRGB**

### 真彩色与伪彩色、直接色的区别

我这里就不以图形学的方式介绍各种花里胡哨的概念，我就用最简单的，作为一个程序员的角度来理解就行了。

我们都知道，一幅图是有很多个像素点组成的，每个像素点在计算机里面都存储了一个像素值。每个像素值会有三个基色分量：R、G、B。然后还有一个基色强度的概念，就是每个基色分量的值，比如 R 为 10，那么就可以说 R 的基色强度是 10，这个基色强度就是用来描述实际屏幕上展示的颜色。

**真彩色**

对于真彩色的话就是像素值里面每个 RGB 存储的什么值，就会直接展示该值所对应的颜色。比如该像素值是 10 10 10，那么三个RGB 的基色强度分别就是  10 10 10，那么这种就称做真彩色。可能你第一直觉，颜色就应该这么表示。

**伪彩色**

对于伪彩色图像其实可以理解为索引图像，他的每个像素值存储的不是直接的基色强度，而是存储的索引。就跟 js 里面的引用变量一样，变量只是个地址，变量所指向的值才是真正的值。

对于伪彩色图像会有一个**颜色表**，是一个[3，255] 的数组，分别对应 0~255 个灰度值的RGB值，对照原理如下：

![image-20190428005103814](/Users/licai/Library/Application Support/typora-user-images/image-20190428005103814.png)



可以看到上图，像素值存储的只是索引号 128，根据索引找到的 RGB 值才是真正的基色强度。

**直接色**

直接色又称假彩色。它和伪彩色的区别就是，前者的每个基色强度都要通过索引找到真正的基色强度。

**总结**

直接色系统产生颜色与真彩色系统相比，相同之处是都采用R，G，B分量决定基色强度，不同之处是前者的基色强度直接用R，G，B决定，而后者的基色强度由R，G，B经变换后决定。因而这两种系统产生的颜色就有差别。试验结果表明，使用直接色在显示器上显示的彩色图像看起来真实、很自然。

 直接色系统与伪彩色系统相比，相同之处是都采用查找表，不同之处是前者对R，G，B分量分别进行变换，后者是把整个像素当作查找表的索引值进行彩色变换。



  描述一幅图像需要使用图像的属性。图像的属性包含分辨率、像素深度、真/伪彩色、图像的表示法和种类等。本节介绍前面三个特性。
  搞清真彩色、伪彩色与直接色的含义，对于编写图像显示程序、理解图像文件的存储格式有直接的指导意义，也不会对出现诸如这样的现象感到困惑：本来是用真彩色表示的图像，但在VGA显示器上显示的图像颜色却不是原来图像的颜色。

  1. 真彩色(true color)
    真彩色是指在组成一幅彩色图像的每个像素值中，有R，G，B三个基色分量，每个基色分量直接决定显示设备的基色强度，这样产生的彩色称为真彩色。例如用RGB 5∶5∶5表示的彩色图像，R，G，B各用5位，用R，G，B分量大小的值直接确定三个基色的强度，这样得到的彩色是真实的原图彩色。
    如果用RGB 8:8:8方式表示一幅彩色图像，就是R，G，B都用8位来表示，每个基色分量占一个字节，共3个字节，每个像素的颜色就是由这3个字节中的数值直接决定，如图5-08(a)所示，可生成的颜色数就是224 ＝16 777 216种。用3个字节表示的真彩色图像所需要的存储空间很大，而人的眼睛是很难分辨出这么多种颜色的，因此在许多场合往往用RGB 5:5:5来表示，每个彩色分量占5个位，再加1位显示属性控制位共2个字节，生成的真颜色数目为215 = 32K。
    在许多场合，真彩色图通常是指RGB 8:8:8，即图像的颜色数等于224，也常称为全彩色(full color)图像。但在显示器上显示的颜色就不一定是真彩色，要得到真彩色图像需要有真彩色显示适配器，目前在PC上用的VGA适配器是很难得到真彩色图像的。
  2. 伪彩色(pseudo color)
    伪彩色图像的含义是，每个像素的颜色不是由每个基色分量的数值直接决定，而是把像素值当作彩色查找表(color look-up table，CLUT)的表项入口地址，去查找一个显示图像时使用的R，G，B强度值，用查找出的R，G，B强度值产生的彩色称为伪彩色。
    彩色查找表CLUT是一个事先做好的表，表项入口地址也称为索引号。例如16种颜色的查找表，0号索引对应黑色，... ，15号索引对应白色。彩色图像本身的像素数值和彩色查找表的索引号有一个变换关系，这个关系可以使用Windows 95/98定义的变换关系，也可以使用你自己定义的变换关系。使用查找得到的数值显示的彩色是真的，但不是图像本身真正的颜色，它没有完全反映原图的彩色。
  3. 直接色(direct color)
    每个像素值分成R，G，B分量，每个分量作为单独的索引值对它做变换。也就是通过相应的彩色变换表找出基色强度，用变换后得到的R，G，B强度值产生的彩色称为直接色。它的特点是对每个基色进行变换。
    用这种系统产生颜色与真彩色系统相比，相同之处是都采用R，G，B分量决定基色强度，不同之处是前者的基色强度直接用R，G，B决定，而后者的基色强度由R，G，B经变换后决定。因而这两种系统产生的颜色就有差别。试验结果表明，使用直接色在显示器上显示的彩色图像看起来真实、很自然。
    这种系统与伪彩色系统相比，相同之处是都采用查找表，不同之处是前者对R，G，B分量分别进行变换，后者是把整个像素当作查找表的索引值进行彩色变换。



## 总结

其中APNG和WebP格式出现的较晚，尚未被Web标准所采纳，只有在特定平台或浏览器环境可以预知的情况下加以采用，虽然均可以在不支持的环境中较好的功能降级，但本节暂不讨论这两种格式。图片格式选择过程如下：

| 图片格式 | 压缩方式 | 透明度 | 动画   | 浏览器兼容                                  | 适应场景                                          |
| :------- | :------- | :----- | :----- | :------------------------------------------ | :------------------------------------------------ |
| JPEG     | 有损压缩 | 不支持 | 不支持 | 所有                                        | 复杂颜色及形状、尤其是照片                        |
| GIF      | 无损压缩 | 支持   | 支持   | 所有                                        | 简单颜色，动画                                    |
| PNG      | 无损压缩 | 支持   | 不支持 | 所有                                        | 需要透明时                                        |
| APNG     | 无损压缩 | 支持   | 支持   | Firefox Safari iOS Safari                   | 需要半透明效果的动画                              |
| WebP     | 有损压缩 | 支持   | 支持   | Chrome Opera Android Chrome Android Browser | 复杂颜色及形状 浏览器平台可预知                   |
| SVG      | 无损压缩 | 支持   | 支持   | 所有（IE8以上）                             | 简单图形，需要良好的放缩体验 需要动态控制图片特效 |

![](<https://image-static.segmentfault.com/999/814/999814740-5493f6b4e013f>)



## 参考链接

- [赵鑫](<https://www.zhihu.com/question/20028452>)